<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayAce ç¶²ç«™ç›£æ§å„€è¡¨æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: bold;
            color: #333;
        }

        .stat-card.success .value {
            color: #10b981;
        }

        .stat-card.warning .value {
            color: #f59e0b;
        }

        .stat-card.error .value {
            color: #ef4444;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .content-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .content-card h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f3f4f6;
        }

        .log-item {
            padding: 15px;
            border-left: 4px solid #e5e7eb;
            margin-bottom: 15px;
            background: #f9fafb;
            border-radius: 4px;
        }

        .log-item.success {
            border-left-color: #10b981;
        }

        .log-item.error {
            border-left-color: #ef4444;
        }

        .log-time {
            color: #6b7280;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .log-message {
            color: #333;
            font-size: 14px;
        }

        .error-list {
            margin-top: 10px;
            padding-left: 20px;
        }

        .error-item {
            color: #ef4444;
            font-size: 13px;
            font-family: monospace;
            margin: 5px 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ® PlayAce ç¶²ç«™ç›£æ§å„€è¡¨æ¿</h1>
            <p>å³æ™‚ç›£æ§ç¶²ç«™åœ–ç‰‡è³‡æºç‹€æ…‹</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>ç›£æ§ç‹€æ…‹</h3>
                <div class="value" id="status">-</div>
            </div>
            <div class="stat-card">
                <h3>æœ€å¾Œæª¢æŸ¥</h3>
                <div class="value" style="font-size: 18px;" id="lastCheck">-</div>
            </div>
            <div class="stat-card">
                <h3>24å°æ™‚æª¢æŸ¥æ¬¡æ•¸</h3>
                <div class="value" id="totalChecks">-</div>
            </div>
            <div class="stat-card">
                <h3>24å°æ™‚éŒ¯èª¤æ•¸</h3>
                <div class="value error" id="errorCount">-</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="manualCheck()">ğŸ” æ‰‹å‹•æª¢æŸ¥</button>
            <button class="btn-secondary" onclick="refreshData()">ğŸ”„ åˆ·æ–°æ•¸æ“š</button>
            <button class="btn-danger" onclick="clearHistory()">ğŸ—‘ï¸ æ¸…é™¤æ­·å²</button>
        </div>

        <div class="content-card">
            <h2>ğŸ“‹ æª¢æŸ¥æ­·å²</h2>
            <div id="historyContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>è¼‰å…¥ä¸­...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        // æ ¼å¼åŒ–æ™‚é–“
        function formatTime(isoString) {
            const date = new Date(isoString);
            return date.toLocaleString('zh-TW', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // è¨ˆç®—ç›¸å°æ™‚é–“
        function relativeTime(isoString) {
            const date = new Date(isoString);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);

            if (diff < 60) return `${diff} ç§’å‰`;
            if (diff < 3600) return `${Math.floor(diff / 60)} åˆ†é˜å‰`;
            if (diff < 86400) return `${Math.floor(diff / 3600)} å°æ™‚å‰`;
            return `${Math.floor(diff / 86400)} å¤©å‰`;
        }

        // ç²å–ç‹€æ…‹
        async function fetchStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/status`);
                const data = await response.json();

                document.getElementById('status').textContent = 'âœ… é‹è¡Œä¸­';
                document.getElementById('status').style.color = '#10b981';

                if (data.lastCheck) {
                    document.getElementById('lastCheck').textContent = relativeTime(data.lastCheck.timestamp);
                }
            } catch (error) {
                document.getElementById('status').textContent = 'âŒ é›¢ç·š';
                document.getElementById('status').style.color = '#ef4444';
            }
        }

        // ç²å–çµ±è¨ˆæ•¸æ“š
        async function fetchStats() {
            try {
                const response = await fetch(`${API_BASE}/api/stats`);
                const data = await response.json();

                document.getElementById('totalChecks').textContent = data.last24h.checks;
                document.getElementById('errorCount').textContent = data.last24h.totalErrors;
            } catch (error) {
                console.error('ç²å–çµ±è¨ˆå¤±æ•—:', error);
            }
        }

        // ç²å–æ­·å²è¨˜éŒ„
        async function fetchHistory() {
            try {
                const response = await fetch(`${API_BASE}/api/history?limit=20`);
                const data = await response.json();

                const container = document.getElementById('historyContainer');

                if (data.checks.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <h3>æš«ç„¡æª¢æŸ¥è¨˜éŒ„</h3>
                            <p>é»æ“Šã€Œæ‰‹å‹•æª¢æŸ¥ã€é–‹å§‹ç›£æ§</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = data.checks.map(check => {
                    const hasErrors = check.errorCount > 0;
                    const statusClass = hasErrors ? 'error' : 'success';
                    const badge = hasErrors
                        ? `<span class="badge error">âŒ ${check.errorCount} å€‹éŒ¯èª¤</span>`
                        : `<span class="badge success">âœ… æ­£å¸¸</span>`;

                    let errorList = '';
                    if (check.errors && check.errors.length > 0) {
                        errorList = `
                            <div class="error-list">
                                ${check.errors.map(err =>
                                    `<div class="error-item">â€¢ ${err.fileName || err.url || 'æœªçŸ¥éŒ¯èª¤'}</div>`
                                ).join('')}
                            </div>
                        `;
                    }

                    return `
                        <div class="log-item ${statusClass}">
                            <div class="log-time">${formatTime(check.timestamp)} (${relativeTime(check.timestamp)})</div>
                            <div class="log-message">
                                ${badge}
                                ${check.type === 'manual' ? 'æ‰‹å‹•æª¢æŸ¥' : 'è‡ªå‹•æª¢æŸ¥'}
                                ${errorList}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('ç²å–æ­·å²å¤±æ•—:', error);
                document.getElementById('historyContainer').innerHTML = `
                    <div class="empty-state">
                        <h3>è¼‰å…¥å¤±æ•—</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // æ‰‹å‹•æª¢æŸ¥
        async function manualCheck() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'â³ æª¢æŸ¥ä¸­...';

            try {
                const response = await fetch(`${API_BASE}/api/check`, {
                    method: 'POST'
                });
                const data = await response.json();

                alert('âœ… ' + data.message);

                // 10ç§’å¾Œåˆ·æ–°æ•¸æ“š
                setTimeout(refreshData, 10000);
            } catch (error) {
                alert('âŒ æª¢æŸ¥å¤±æ•—: ' + error.message);
            } finally {
                button.disabled = false;
                button.textContent = 'ğŸ” æ‰‹å‹•æª¢æŸ¥';
            }
        }

        // åˆ·æ–°æ•¸æ“š
        function refreshData() {
            fetchStatus();
            fetchStats();
            fetchHistory();
        }

        // æ¸…é™¤æ­·å²
        async function clearHistory() {
            if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ­·å²è¨˜éŒ„å—ï¼Ÿ')) return;

            try {
                await fetch(`${API_BASE}/api/history`, {
                    method: 'DELETE'
                });
                alert('âœ… æ­·å²è¨˜éŒ„å·²æ¸…é™¤');
                refreshData();
            } catch (error) {
                alert('âŒ æ¸…é™¤å¤±æ•—: ' + error.message);
            }
        }

        // åˆå§‹åŒ–
        refreshData();

        // è‡ªå‹•åˆ·æ–°ï¼ˆæ¯30ç§’ï¼‰
        setInterval(refreshData, 30000);
    </script>
</body>
</html>
